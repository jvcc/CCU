
<!DOCTYPE html>
<html lang="en">
	<head>
	    <meta charset="utf-8">
	    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	    <meta name="viewport" content="width=device-width, initial-scale=1">
		
					<meta name="description" content="no se" />
				
					<meta name="keywords" content="tampoco se" />
				    
	    <meta name="author" content="">

	    <title>no se</title>
	    
	    <link href="/public/stylesheets/google-font.css" rel='stylesheet' type='text/css'>
	    <link href="/public/stylesheets/bootstrap-3.3.2.min.css" rel="stylesheet" media="screen,print">
	    <link href="/public/stylesheets/font-awesome-4.3.0.css?v=0.1" rel="stylesheet" media="screen,print">
		
	    	
<link href="/public/stylesheets/bootstrap-3.3.2.min.css" rel="stylesheet" media="screen,print">
	    
                            <style>/* estas definiciones solo aplican para esta agencia; la idea es cambiar la imagen asociada al bin de la tarjeta. Freddy.*/
#bannerPlace{
display: block;
box-sizing: border-box;
background: url(
http://res.cloudinary.com/hyvrprjak/image/upload/v1490299175/TravelClubApps/Metrogas/Metrogas_LogoAcumulaElDoble1.png) no-repeat; /* La imagen sustituta de fondo*/

width: 410px; /* La anchura de la nueva imagen */
height: 405px; /* La altura de la nueva imagen */
}
/* fin definiciones para esta agencia*/

#header {box-shadow:none;  min-height:  inherit  !important ;}
#menu-header1 {
  background: url(http://res.cloudinary.com/travelclub/image/upload/pago/bch-delta-header.jpg) center 100% repeat-y;
  height: 88px; min-height: 88px !important ; box-shadow: inherit  !important ;
  margin-bottom: 60px; }
  #menu-header1 .logo-header {
    height: 88px; }
  #menu-header1 .first-color {
    background: #255a9b;
    height: 88px; }
  #menu-header1 .second-color {
    height: 88px; }
  #menu-header1 .columns {
    margin: 0; }

footer.extras { font-family: 'Open Sans', sans-serif; font-weight:300; font-size: 15px; line-height:24px; color:#f4f4f4; overflow-x:hidden; -webkit-font-smoothing: antialiased; /* Fix for webkit rendering */ -webkit-text-size-adjust: 100%; background: #003366; font-family: 'Open Sans', sans-serif; color:#FFF;}
 footer.extras .small {  font-size: 12px; }

.container1  { position: relative; width: 1200px; margin: 0 auto; padding: 0; }
.container1 .column, .container1 .columns { float: left; display: inline; margin-left: 10px; margin-right: 10px; margin-top: 10px; margin-bottom: 10px;}

/* Base Grid */
		.container1 .one.column,
		.container1 .one.columns                     { width: 55px;  }
		.container1 .two.columns                     { width: 130px; }
		.container1 .three.columns                   { width: 205px; }
		.container1 .four.columns                    { width: 280px; }
		.container1 .five.columns                    { width: 355px; }
		.container1 .six.columns                     { width: 430px; }
		.container1 .seven.columns                   { width: 505px; }
		.container1 .eight.columns                   { width: 580px; }
		.container1 .nine.columns                    { width: 655px; }
		.container1 .ten.columns                     { width: 730px; }
		.container1 .eleven.columns                  { width: 805px; }
		.container1 .twelve.columns                  { width: 880px; }
		.container1 .thirteen.columns                { width: 955px; }
		.container1 .fourteen.columns                { width: 1030px; }
		.container1 .fifteen.columns                 { width: 1105px; }
		.container1 .sixteen.columns                 { width: 1180px; }

		.container1 .one-third.column                { width: 380px; }
		.container1 .two-thirds.column               { width: 780px; }

		/* Offsets */
		.container1 .offset-by-one                   { padding-left: 75px;  }
		.container1 .offset-by-two                   { padding-left: 150px; }
		.container1 .offset-by-three                 { padding-left: 225px; }
		.container1 .offset-by-four                  { padding-left: 300px; }
		.container1 .offset-by-five                  { padding-left: 375px; }
		.container1 .offset-by-six                   { padding-left: 450px; }
		.container1 .offset-by-seven                 { padding-left: 525px; }
		.container1 .offset-by-eight                 { padding-left: 600px; }
		.container1 .offset-by-nine                  { padding-left: 675px; }
		.container1 .offset-by-ten                   { padding-left: 750px; }
		.container1 .offset-by-eleven                { padding-left: 825px; }
		.container1 .offset-by-twelve                { padding-left: 900px; }
		.container1 .offset-by-thirteen              { padding-left: 975px; }
		.container1 .offset-by-fourteen              { padding-left: 1050px; }
		.container1 .offset-by-fifteen               { padding-left: 1125px; }	









=========================

[2:03] 
/* ESTILOS PROMOCIONES
=============== */

.pay-detail {
    padding-top: 30px;
    padding-bottom: 30px;
}


.pay-detail .user-name {
    font-size: 15px;
    color: #000000 ;
    line-height: 20px;
}
.pay-detail .info-quantity {
    font-size: 15px;
    font-weight: 600;
    color: #4A5359 ;
    line-height: 21.86px;
    padding-top: 5px;
    padding-bottom: 5px;
    width: 65%;
}

.pay-detail .table-detail {
    border:1px solid #ADC1C8 ;
    border-radius: 5px;
    float: left;
    overflow: hidden;
    width: 66.66666667%;
    margin: 0 auto;
}

.pay-detail .table-detail table {
    width: 101%;
}
.pay-detail .table-detail thead {
    background-color: #ADC1C8 ;
}
.pay-detail .table-detail thead tr th,
.pay-detail .table-detail tbody tr th {
    font-size: 14px;
    color: #4A5359 ;
    line-height: 20px;
    padding: 14px 10px;
    text-transform: uppercase;
    text-align: center;
}
.pay-detail .table-detail tbody tr th {
    text-align: left;
}

.pay-detail .table-detail tbody tr {
    border-top: 1px solid #ADC1C8 ;
}
.pay-detail .table-detail tbody tr td {
    font-size: 14px;
    color: #4A5359 ;
    padding: 14px 10px;
    text-align: center;
}

.pay-detail .without-txt {
    text-indent: -9999px;
}
.pay-detail .circle-offer {
    background-color: #E2EBED ;
   border-radius: 20px;
    font-weight: 600;
   color: #4A5359 ;
   padding: 5px;
   width: 40px;
   height: 40px;
   display: table;
   line-height: 2.8;
}
.pay-detail .banner-promo {
    overflow: hidden;
    max-height: 265px;
}
.pay-detail .balance-info {
    padding-top: 30px;
    padding-left: 0;
    padding-right: 0;
}
.pay-detail .balance-info .alert-info {
    background-color: #E2EBED ;
    border-color: #ADC1C8 ;
}

.pay-detail .balance-info .icon-card {
    background-image: url(../img/icon-card.svg);
    background-repeat: no-repeat;
    background-position: center;
    display: inline-block;
    width: 30px;
    height: 30px;
    vertical-align: middle;
}

.pay-detail .balance-info span {
    display: inline-block;
    vertical-align: middle;
}

/* media
=================================== */

@media screen and (max-width: 992px) {
    .pay-detail .info-quantity {
        width: 100%;
    }
}

@media screen and (max-width: 769px) {
    .pay-detail .table-detail,
    .pay-detail .banner-promo  {
        width: 100%;
    }
    .pay-detail .banner-promo {
        padding-top: 30px;
        text-align: center;
    }
    
}


@media screen and (max-width: 500px) {
    .out-txt-450px {
        display: none;
    }
}</style>
                        	    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	    <!--[if lt IE 9]>
	      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
	      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
	    <![endif]-->
			    	<link rel="shortcut icon" type="image/png" href="https://res.cloudinary.com/travelclub/image/upload//v1446827892/pago/Icon_TC.ico">
		            	</head>
	<body>
            		 
		<header id="header">
	<!--<div class="col-md-6 logo">
		<img class="hidden-xs" src="../../public/images/logo-a.png" alt="logo-latercera" title="logo">
		<img class="visible-xs" src="../../public/images/logo-b.png" alt="logo-latercera" title="logo">
	</div>
	<div class="col-md-6 text-right phone-number">
		<img src="../../public/images/icon-phone.png" alt="phone" title="icon"><span>6003292800</span>
		
	</div>-->
	<!-- CSS -->
<meta name="viewport" content="initial-scale=1, maximum-scale=1">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700" rel="stylesheet" type="text/css">
	
<nav id="menu-header1">
  <div class="container1">
    <div class="five columns">
       <img class="img-responsive logo-header" src="https://res.cloudinary.com/hyvrprjak/image/upload/v1535147153/TravelClubApps/logo_ccu_pasarela.png" alt=""/>
    </div>
    <div class="seven columns first-color">&nbsp;</div>
    <div class="four columns">
      <img class="img-responsive logo-header" src="https://res.cloudinary.com/travelclub/image/upload/v1446047936/pago/logo_bch.jpg" alt=""/>
    </div>
    <div class="second-color"></div>
  </div>
</nav>


</header>
			
         



<link rel="stylesheet" type="text/css" href="/public/stylesheets/payment-information-style.css/">

<script>
     window.onload = function(e) {
                window.location.hash="no-back-button";
                window.location.hash="Again-No-back-button";//again because google chrome don't insert first hash into history
                window.onhashchange=function(){window.location.hash="no-back-button";}
            };
</script>

<script src='https://res.cloudinary.com/hyvrprjak/raw/upload/v1529513485/TravelPay/javascripts/decimal.min.js'></script>

<main class="payment">
    <form action="/checkout/finalizar" method="get" id="frmOrderPay" role="form">
        <input type="hidden" name="rutCliente" value="164574601">
        <input type="hidden" value="0" id="numCuotas">
        <input type="hidden" value="VN" id="tipoPago">
        <input type="hidden" id="fechaVctoTarjeta" name="fechaVctoTarjeta">
        <input type="hidden" id="realDP" name="realDP">
        <input type="hidden" id="exchangeRate" value="657.0">
        <input type="hidden" id="tasasAmount" value="0">
        <input type="hidden" id="totOrder" value="">
        <input type="hidden" id="nroAviosHdn" value="0">



        <div>

            <div class="row">
                <div class="col-md-8 col-md-offset-2" style="max-width:800px">
                    <br>
                    <p>Sr(a)
                                                    Ambiente Desarrollo Test
                                                                    </p>
                </div>
            </div>
            
            
                        <style>
                .m1, .m2, .m3, .m4, .m5, .m6, .m7, .m8, .m9, .m10 {
                    display: none;
                }
                .none {
                    display:block;
                }
            </style>
            
            
            
            
                            <div class="balance-info col-md-8 col-md-offset-2">
                                                                                                        <div class="alert alert-info" style="display: inline-block; width: 100%;">
                                    <div class="info-card">
                                        <img src="https://res.cloudinary.com/hyvrprjak/image/upload/v1529513399/TravelPay/images/icon-card.svg" alt="imagen tarjeta" />
                                    </div>
                                    <div class="info-card" id="panelazul" style="max-width: 90%;">
                                        
                                                                                                                                                                                        <b>
                                                        Tu saldo de Dolares-Premio a la fecha es de
                                                        <span class="light-blue" >
                                                        2000
                                                        </span>
                                                    </b>
                                                    .<br/>
                                                                                                                                                                                                                                
                                                                                    <b>El monto total a pagar
                                                                                            con tarjeta de credito
                                                                                        es de <span class="light-blue">$ 100.000.</span></b><br/>
                                                                                                                                                    </div>
                            </div>
                                                            </div>
                        
            

                        
                        
                                                                   <div class="row" id="stepDP" >
                            <div class="col-md-8 col-md-offset-2" style="max-width:800px">
                                <span id="circleBase1" class="circleBase">1</span>
                                                                                                <span class="tituloStep"> Ingresa los Dolares-Premio a canjear</span>
                                                                <div style="margin-left: 50px;margin-top:20px;">
                                    <div class="form-group">
                                        <label class="dp_label" for="dolaresPremio">
                                                                                                                                    Dolares-Premio
                                                                                    </label>
                                                                                                                        <input type="text" name="montoDP" class="form-control" id="dolaresPremio" style="width: 130px;"
                                                                                       >
                                                                                <span style="font-style: italic; font-weight: normal;">Equivalente a
                                                                                                                    $<span id="convertedDP">0</span></span>
                                                                                                                                                                                                        <a id="useMax" style="cursor: pointer; margin-left: 15px;">Usar maximo Dolares-Premio Disponibles</a>
                                                                                                                    </div>
                                                                                                            <p>Maximo de Dolares-Premio a canjear en esta compra es <b id="maxAvailableDP">2000.0</b></p>
                                                                                                                                                <p id="TCMinDP" style="display: none; color: red;" class="tcError">$0.0 Dolares-Premio minimo</p>
                                </div>
                            </div>
                        </div>
                        <br>
                        <br>
                            
                                    <div id="stepTC" class="row"    >
            <div class="col-md-8 col-md-offset-2" style="max-width:800px">
                <span id="circleBase2" class="circleBase">2</span>
                <span class="tituloStep titleMarginLeft">Monto a pagar con Tarjeta de Credito</span>

                <div style="margin-left: 50px;">
                    <div class="panel-body yellow-pane" style="padding: 20px;margin-top: 10px;">
                        Valor a pagar con Tarjeta de Credito:
                        <span class="light-blue pull-right">$ <span id="montoAPagar2">100.000</span></span>
                        <p style="color:red; display: none;" id="cartelMinRoundingAmount">No se permite pagar con Tarjeta de credito menos de (10 CLP), disminuya  el monto de Dolares-Premio a canjear</p>
                    </div>

                    <div class="col-md-3" style="position: absolute; margin-left: 650px; margin-top: 20px;" id="bannerPlace">

                    </div>

                    <br>

                    <div class="form-group">
                        <label for="numeroTarjeta">Ingresa tu tarjeta de credito</label>
                        <input type="text" maxlength="16" name="numeroTarjeta" class="form-control" id="numeroTarjeta" style="width: 250px;">
                        <span id="spTCPicPlacer"></span><img src="https://res.cloudinary.com/hyvrprjak/image/upload/v1529513399/TravelPay/images/loading.gif"    style="display: none;" id="loadingTCPic">
                        <p id="lblNroTarjeta" style="color: red; display: none;" class="tcError">Nro. de Tarjeta invalido</p>
                        <p id="TCError" style="display: none; color: red;" class="tcError"></p>
                        <p id="TCErrorBin" style="display: none; color: red;" class="tcError">El numero de tarjeta no se puede utilizar</p>
                        <p id="TCErrorMissing" style="display: none; color: red;" class="tcError">El numero de tarjeta no se puede utilizar</p>
                        <p id="SpecialPromoMsg" style="display: none; color: black;" class="tcError">Verificando Promociones...</p>
                    </div>

                    <br>

                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group" style>
                                <label for="select1">Ingresa Fecha de Vencimiento</label>
                                
<select name="mesVto" size="1" id="select1" class="form-control" style="margin-right: 10px;width:100px;display:inline;" >
                                                                    <option value="01">01</option>
                                                                <option value="02">02</option>
                                                                <option value="03">03</option>
                                                                <option value="04">04</option>
                                                                <option value="05">05</option>
                                                                <option value="06">06</option>
                                                                <option value="07">07</option>
                                                                <option value="08">08</option>
                                                                <option value="09">09</option>
                                                                <option value="10">10</option>
                                                                <option value="11">11</option>
                                                                <option value="12">12</option>
                                                                    </select>

                                
<select name="anioVto" size="1" id="select2" class="form-control" style="display:inline;width:100px;" >
                                                                        <option value="17">2017</option>
                                                                    <option value="18">2018</option>
                                                                    <option value="19">2019</option>
                                                                    <option value="20">2020</option>
                                                                    <option value="21">2021</option>
                                                                    <option value="22">2022</option>
                                                                    <option value="23">2023</option>
                                                                    <option value="24">2024</option>
                                                                    <option value="25">2025</option>
                                                                    <option value="26">2026</option>
                                                                    <option value="27">2027</option>
                                                                    <option value="28">2028</option>
                                                                    <option value="29">2029</option>
                                                                    <option value="30">2030</option>
                                                                    <option value="31">2031</option>
                                                                    <option value="32">2032</option>
                                                                    <option value="33">2033</option>
                                                                    <option value="34">2034</option>
                                                                    <option value="35">2035</option>
                                                                    <option value="36">2036</option>
                                                                    <option value="37">2037</option>
                                                                    <option value="38">2038</option>
                                                                    <option value="39">2039</option>
                                                                    <option value="40">2040</option>
                                                                    <option value="41">2041</option>
                                                                    <option value="42">2042</option>
                                                                    <option value="43">2043</option>
                                                                    <option value="44">2044</option>
                                                                    <option value="45">2045</option>
                                                                    <option value="46">2046</option>
                                                                    <option value="47">2047</option>
                                                                    <option value="48">2048</option>
                                                                    <option value="49">2049</option>
                                                                    <option value="50">2050</option>
                                 
                                    </select>

                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="codigoVerificacion">Codigo de seguridad</label>
                                <input type="text" name="codigoVerificacionTC" onkeypress='return event.charCode >= 48 && event.charCode <= 57' maxlength="3" id="codigoVerificacion" class="form-control" style="width: 90px;">
                                <span class="glyphicon glyphicon-question-sign" id="helpTcCode" style="cursor: pointer;"></span>
                                <img id="imgVerificacion" style="display: none; position: absolute; margin-top: 12px;" src="/public/images/tarjeta.png">
                                <p id="TCErrorVerif" style="display: none; color: red;" class="tcError">Debe completar este campo</p>
                                <p id="TCErrorVerifLong" style="display: none; color: red;" class="tcError">Este campo debe contener 3 digitos</p>
                            </div>
                        </div>
                    </div>


                    <div class="form-group">

                        <label for="numeroTarjeta">Numero de Cuotas</label>
                        
<select name="numeroCuotasTC" size="1" id="numeroCuotas" class="form-control" style="width:250px" >
                            <option value="-"  > - 
</option>                            </select>

                        <img src="https://res.cloudinary.com/hyvrprjak/image/upload/v1529513399/TravelPay/images/loading.gif" style="display: none;" id="loadingNroCuotas">
                        <p id="TCCSInteres" style="display: none; color: red;" class="tcError">Debe Seleccionar algun tipo de Cuota</p>
                    </div>

                </div>
            </div>
        </div>
        
		
        <br><br>

                <div class="row" >
            <div class="col-md-8 col-md-offset-2" style="max-width:800px">
                <span id="circleBase3" class="circleBase">3</span>
                <span class="titleMarginLeft tituloStep"> Resumen de pago</span>

                <ul class="brief" style="max-width:100%">

                    <input type="hidden" id="isDp" value="false">
                    <input type="hidden" id="hasPromo" value="false">
                    <input type="hidden" id="totalDescuento" value="0">
                    <input type="hidden" id="totalNoDescuento" value="100.000">

                                            <li>
                            <span class="title">Total a pagar:</span>
                            <span class="value">$ <span>100.000</span></span>
                        </li>
                    
                    
                        <li >
                        <span class="title">Dolares-Premio Canjeados:</span>
                        <span class="value">$ <span id="dpTotal">0</span></span>
                        </li>

                                            <li class="tcBco">
                            <span class="title">Tarjeta de Credito Banco de Chile:</span>
                            <span class="value">$ <span id="montoAPagar">100.000</span></span>
                        </li>
                    
                                            <li class="total">

                            <div style="display:none;" id="resTotalNeg">100.000</div>

                                                                            <span class="value">$ <span>100.000</span></span>
                        
                            <span class="title">TOTAL:&nbsp;</span>
                        </li>
                    
                    <li style="display:none;">
                        <label id="totalCompra" style="font-weight: 500;">100.000</label>
                        $ <label id="resMontoTarj">100.000</label>
                    </li>
                </ul>
            </div>
        </div>
                <div class="row">
            <div class="col-md-6 col-md-offset-2" style="margin-bottom: 30px; margin-top: 30px; margin-left:20%;">
                <label>Email</label> (Donde recibiras tu comprobante de pago y/o canje de Dolares Premio)
                <input type="text" name="email" value="" id="email" style="width: 100%;">
                <input type="checkbox" name="chkOfertas" id="chkOfertas" checked="checked"/><label style="font-weight: 100; margin-left: 5px;">Deseo recibir Ofertas del Programa Travel.</label>
                <div class="alert-email"></div>
            </div>
            </div>
                        <div class="row">
                <div class="col-md-8 col-md-offset-2" style="max-width:800px; text-align:center;">
                    <a class="btn boton-pagar" title="Pagar" id="btnPagar"> Pagar  </a>
                </div>
            </div>
        </div>
    </form>
          <form id="promotion-code-form" action="/checkout/4cec4e83bcf30154f0c1e14f31e766cbO53520/promotionCode" method="post">
         <input id="promotion-code-form-input" type="hidden" name="promoCode">
     </form>
          </main>
<br>

<div id="line1" class="line"></div>
<div id="line2" class="line"></div>
<div id="line3" class="line"></div>


<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">No es posible efectuar el pago</h4>
            </div>
            <div class="modal-body">
                El periodo de expiracion se ha cumplido; por favor vuelva atras e intentelo nuevamente.
            </div>
            <div class="modal-footer">
                <a type="button" class="btn btn-default" href="http://www.mocky.io/v2/5b355cb22f00006e003762c9">Aceptar</a>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="modalAlreadyPaid" tabindex="-1" role="dialog" aria-labelledby="modalAlreadyPaidLabel" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="modalAlreadyPaidLabel">No es posible efectuar el pago</h4>
            </div>
            <div class="modal-body">
                Su compra ya fue pagada.
            </div>
            <div class="modal-footer">
                <a type="button" class="btn btn-default" href="http://www.mocky.io/v2/5b355cb22f00006e003762c9">Aceptar</a>
            </div>
        </div>
    </div>
</div>

<!-- Modal No DP-->
<div class="modal fade" id="modalNoDP" tabindex="-1" role="dialog" aria-labelledby="modalAlreadyPaidLabel" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span style="font-size: 22px;" aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="modalAlreadyPaidLabel">No es posible efectuar el pago</h4>
            </div>
        </div>
    </div>
</div>

<!-- Modal Total Error -->
<div class="modal fade" id="modalTotalError" tabindex="-1" role="dialog" aria-labelledby="modalAlreadyPaidLabel" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span style="font-size: 22px;" aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="modalAlreadyPaidLabel">No es posible efectuar el pago</h4>
            </div>
        </div>
    </div>
</div>

<!-- Modal No Se pudo obtener nombre-->
<div class="modal fade" id="modalNoName" tabindex="-1" role="dialog" aria-labelledby="modalAlreadyPaidLabel" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="modalAlreadyPaidLabel">
                    En estos momentos no podemos obtener su saldo de Dolares-Premio. Usted podra continuar su compra pagando con sus Tarjetas Travel
                </h4>
            </div>
            <div class="modal-footer">
                <a type="button" class="btn btn-default"  onclick="pagarTarjetaCheckout()">Pagar con Tarjeta</a>
                    <a type="button" class="btn btn-default"  onclick="retryCheckout()">Reintentar</a>
                <a class="light-blue" href="http://www.mocky.io/v2/5b355cb22f00006e003762c9">Volver a la pagina principal</a>
            </div>
        </div>
    </div>
</div>

<!-- Modal Monto Erroneo -->
<div class="modal fade" id="modalAmountError" tabindex="-1" role="dialog" aria-labelledby="modalAlreadyPaidLabel" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span style="font-size: 22px;" aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="modalAlreadyPaidLabel">No es posible efectuar el pago</h4>
            </div>
            <div class="modal-body">
                Estimado cliente, el o los montos con los cuales intenta abonar el pago son invalidos. Por favor verifique los mismos, y reintente el pago.
            </div>
        </div>
    </div>
</div>


 

		
				<footer id="footer">
<!--	<div class="col-md-4 text-center">
		<img src="../../public/images/la-tercera.png" alt="logo-latercera" title="logo">
	</div>
	<div class="col-md-4 text-center">
		<ul>
			<li>Condiciones Generales</li>
			<li>Compra de Suscripciones</li>
			<li>La Tercera</li>
		</ul>
	</div>
	<div class="col-md-4 text-center follow-us">
		<span>Seguinos en:</span>
		<ul>
			<li><a href=""><img src="../../public/images/twitter.svg" alt="logo-twitter" title="logo"></a></li>
			<li><a href=""><img src="../../public/images/facebook.svg" alt="logo-facebook" title="logo"></a></li>
		</ul>	
		
	</div>-->

<footer class="extras">   
 <div class="container">
        <!--<div class="text-center"><img src="https://promociones.bancochile.cl/promocion/delta/bch/images/firma.png" /></div>-->
        <br>
    <div class="justify"> <p> 
Beneficio exclusivo para clientes personas naturales, titulares de tarjetas de crédito emitidas por Banco de Chile, incluye Banco Edwards y CrediChile, que realicen la compra de productos en portal de ventas Club de Amigos CCU-BCH de forma online. 10% de descuento adicional es válido hasta el 30 de septiembre de 2018. El descuento se realizará a través del botón de pago del Banco de Chile al momento mismo de la venta. La venta, descuento y distribución de los productos es de exclusiva responsabilidad de CCU S.A., no cabiéndole a Banco de Chile ni Travel Club intervención alguna en ello ni en la ulterior atención que ello demande. Transacciones en cuotas están afectas a impuesto de timbre DL 3475, el que es de cargo del cliente. Infórmese sobre la garantía estatal de los depósitos en su banco o en  <b>www.sbif.cl</b>
          <br>
        </div>
      </div>
    </footer>

</footer>		 
					<script src="https://res.cloudinary.com/hyvrprjak/raw/upload/v1529513486/TravelPay/javascripts/jquery-1.11.2.min.js"></script>
			<script src="/public/javascripts/bootstrap-3.3.2.min.js"></script>
				
		        
    <script src="https://res.cloudinary.com/hyvrprjak/raw/upload/v1529513486/TravelPay/javascripts/jquery-1.11.2.min.js"></script>
    <script src="/public/javascripts/bootstrap-3.3.2.min.js"></script>
    
    <script type="text/javascript">

        /* CONSTANTES DE CALCULO DE DPS Y CLPS */
        var AGENCY_ROUNDING_AMOUNT = 10.0;
        var MAXIMO_DP = "2000.0";
        var AGENCY_DOLLAR_EXCHANGE_RATE = 657;
        var INSTALLMENTS_RESTRICTION = "";
        var MAX_DP_AMOUNT_RESTRICTION = "152.207" != "" ? "152.207" : MAXIMO_DP;
        var ORDER_TOTAL_CLPS = "100.000";
        

        /* OTRAS CONSTANTES */
        var PROMOTION_CODE = "";
        var AGENCY_SLUGIFIED_PATH = "travel_ccu";
        var ORDER_BUYING_ID = "53520";
        var ORDER_RUT = "164574601";

        var numOK=false;

        function pagarTarjetaCheckout(){
        if(location.href.search("bch") != -1){
            location.assign(location.href.replace(/bch/,"client-not-registered-yet"));
        }
        else {
             location.assign(location.href.replace(/client-data-not-recovered/,"client-not-registered-yet"));
        };
        };

        function retryCheckout(){
        if(location.href.search("client-data-not-recovered") == -1){
            location.assign(location.href.replace(/bch/,"client-data-not-recovered"));
        }
        else{
            location.reload();
        };
        };

        function montoAPagar(valor) {
            
            $('#resMontoTarj').html(valor);
            actualizarTotal();
        };
        
        function invalidarTC(campo){
            $( "#"+campo ).css( "display","block" );
              $( "#numeroTarjeta" ).css("border-color", "red");
              numOK=false;
              setTimeout(function() { multiAlinear(); }, 500);
        }

        function invalidarCampo(campo){
            $( "#"+campo ).css( "display","block" );
            setTimeout(function() { multiAlinear(); }, 500);
        }

        function toSingle(digit){
            if(digit > 9){
                var tmp = digit.toString();
                var d1 = parseInt(tmp.charAt(0));
                var d2 = parseInt(tmp.charAt(1));
                return (d1 + d2); 
            } else {
                return digit;
            }
        }
        
        function isValid(ccNum){
            var double = true;
            var numArr = [];
            var sumTotal = 0;
            var charCount = ccNum.toString().length;
            
            for(i=0; i<charCount; i++){
                var digit = parseInt(ccNum.charAt(i));
         
                if(double){
                    digit = digit * 2;
                    digit = toSingle(digit);
                    double = false;
                } else {
                    double = true;
                }
                numArr.push(digit);
            }
         
            for(i=0; i<numArr.length; i++){
                sumTotal += numArr[i];
            }

            var diff = eval(sumTotal % 10);

            return (diff == "0");
        }
        
        function actualizarTotal(){
            var total = parseFloat($('#resTotalNeg').html().replace(/\./g, ''));
            $('#totalCompra').html(total);
        }

        function isADeletingKey(characterCode) {
            return characterCode == 8 || characterCode == 46;
        }
        $(function() {
            if ( parseFloat(MAXIMO_DP)<parseFloat(152)) {
                $('#panelazul').html($('.DP1').html());
            }
            else {
                $('#panelazul').html($('.DP2').html());
            }
    
            $('#numeroTarjeta').change(function() {
                numOK=false;
                $(".tcError").css("display", "none");
            });

            $('#codigoVerificacion').change(function() {
                $(".tcError").css("display", "none");
            });
            
            $('#useMax').click(function() {
                $('#dolaresPremio').val(MAXIMO_DP);
                calculateDP();
            });

            (function(){
                var button = $('#promotion-code-button');
                function apply(event) {
                    var code = $('#promotion-code-input').val().trim();
                    if(code == "") {
                        $('#promotion-code-alert').html('Codigo de promocion vacio').css('display', 'block');
                        $('#promotion-code-input').val('');
                        return;
                    }
                    $('#promotion-code-form-input').val(code);
                    $('#promotion-code-form').submit();
                }
                function undo(event) {
                    $('#promotion-code-form').submit();
                }
                switch(button.data('type')) {
                    case 'apply':
                        button.click(apply);
                        break;
                    case 'undo':
                        button.click(undo);
                        break;
                    default:
                        //throw 'boton de codigo de promocion sin tipo definido';
                }
            })();
            $('#btnPagar').click(function(event) {
                $("#btnPagar").attr("disabled", "disabled");
                $(".tcError").css("display", "none");
                var inputEmail = $('#email').val();

                if (inputEmail != undefined){

                    var regexEmail = /^[a-z0-9]+[a-z0-9-_\.]*@([a-z0-9-_]*(\.[a-z]{2,4}){1,5})$/i;

                    if (!regexEmail.test(inputEmail.trim())) {
                        $('.alert-email').html("Por favor, completar el email, y con un formato valido");
                        $("#btnPagar").removeAttr("disabled");
                        return false;
                    }
                }

                if ($('#montoAPagar').html()!= undefined && $('#montoAPagar').html()!='0') {

                    if ($('#cartelMinRoundingAmount').css('display')=='block'){
                        $('#dolaresPremio').focus();
                        $("#btnPagar").removeAttr("disabled");
                        return false;
                    }

                    if ( $('#numeroTarjeta').val()==''){
                        invalidarCampo("TCErrorMissing");
                        $("#btnPagar").removeAttr("disabled");
                        return false;
                    }

                    if ($('#codigoVerificacion').val()==''){
                        invalidarCampo("TCErrorVerif");
                        $("#btnPagar").removeAttr("disabled");
                        return false;
                    }

                    if ($('#codigoVerificacion').val().length<3){
                        invalidarCampo("TCErrorVerifLong");
                        $("#btnPagar").removeAttr("disabled");
                        return false;
                    }

                    if ( ($("#numCuotasSI").val()=='-') && ($("#numCuotasCI").val()=='-') ){
                        invalidarCampo("TCCSInteres");
                        $("#btnPagar").removeAttr("disabled");
                        return false;
                    }

                    if (!numOK){
                        alert('El nro de Tarjeta ingresado es incorrecto');
                        $("#btnPagar").removeAttr("disabled");
                          return false;
                    }

                    event.preventDefault();

                    var binverif = $("#numeroTarjeta").val().substring(0,6);

                    $.ajax({
                        url: "/checkout.checkoutcontroller/verificarNroYTipoTarjeta?bin=" +binverif
                                + "&buyingId=" + ORDER_BUYING_ID
                                + "&slugAgency=" + AGENCY_SLUGIFIED_PATH
                                + "&promo=" + PROMOTION_CODE
                        }).done(function(d) {
                            if (d=='NO'){
                                numOK=false;
                                var text = "El numero de tarjeta ingresado debe pertenecer a ";
                                var agencyName = "BancoChile o Edwards | citi";

                                if ("entelvisa" == AGENCY_SLUGIFIED_PATH){
                                    agencyName = "Entel Visa";
                                }

                                text += agencyName;

                                $("p#TCError").text(text);
                                $("#TCError").css( "display","block" );
                                $("#numeroTarjeta" ).css("border-color", "red");
                                $("#btnPagar").removeAttr("disabled");
                            }
                            else if (d=='OK') {
                                sendPayment("CONTC");
                            }
                            else if (d=='YAPAGADO'){
                                $('#modalAlreadyPaid').modal({show:true});
                                return false;
                            }
                        });
                }
                else {
                    sendPayment("SINTC");
                }
                
            });

            function representsAPrintableCharacter(characterCode){
                return characterCode > 47 && characterCode < 112 && characterCode != 91 && characterCode != 92 && characterCode != 93;
            }

            function representOtherSignificantCharacters(characterCode){
                return isADeletingKey(characterCode) || characterCode == 32;
            }

            function isANumber(characterCode){
                return (characterCode >= 48 && characterCode <= 57) || (characterCode >= 96 && characterCode <= 105);
            }

            function isADirectionArrow(characterCode){
                return characterCode >= 37 && characterCode <= 40;
            }

            $('#numeroTarjeta').keypress(function(e){
                    return isANumber(e.which) || isADeletingKey(e.which) || isADirectionArrow(e.which);
                }
            );

            $('#dolaresPremio').keyup(function(e) {
                if ( representsAPrintableCharacter(e.which) || representOtherSignificantCharacters(e.which) ) {

                    // almaceno la posicion actual del cursor
                    var start = this.selectionStart;
                    var end = this.selectionEnd;

                    if ( $('#dolaresPremio').val().indexOf('.') != -1 ) {
                        var newValue = $('#dolaresPremio').val();
                        $('#dolaresPremio').val(newValue.split('.')[0]);
                    }
                    if (isNaN($('#dolaresPremio').val()) || $('#dolaresPremio').val()==''){
                        $('#dolaresPremio').val("");
                    } else if ( parseFloat($('#dolaresPremio').val()) < 0.0){
                        $('#dolaresPremio').val(parseFloat($('#dolaresPremio').val()*-1));

                    }

                    calculateDP();

                    // restauro la posicion del cursor
                    this.setSelectionRange(start, end);
                }
            });

            
            $('#dolaresPremio').focusout(function() {
                if (isNaN($('#dolaresPremio').val()) || $('#dolaresPremio').val()==''){
                    $('#dolaresPremio').val("0");                    
                }                
                calculateDP();
            });


            $('#numeroTarjeta').focusout(function() {
                if ( ($("#numeroTarjeta").val()!='') && (!numOK) ) {
                    var validTC = isValid($("#numeroTarjeta").val());
                    if (!validTC){
                        invalidarTC("lblNroTarjeta");
                        $( "#spTCPicPlacer" ).html("");
                        $( "#bannerPlace" ).html("");
                    }
                    else {
                        $( "#numeroTarjeta" ).css("border-color", "green");
                        $( "#lblNroTarjeta" ).css( "display","none" );
                        setTimeout(function() { multiAlinear(); }, 500);
                        numOK=true;
                                                getCardPics();
                    
                        $( "#loadingNroCuotas" ).css("display","block");
                        setTimeout(function() { multiAlinear(); }, 250);
                        var bin = $("#numeroTarjeta").val().substring(0,6);
                        $.ajax({
                              url: "/checkout.checkoutcontroller/getNroCuotas?bin="+bin+"&cSInteres="+$('#tipoPago').val()+"&slugAgency="+AGENCY_SLUGIFIED_PATH+"&buyingId="+ ORDER_BUYING_ID
                            }).done(function(d) {
                                fillNroCuotas3(d);
                                $( "#loadingNroCuotas" ).css("display","none");
                                setTimeout(function() { multiAlinear(); }, 250);   
                            });
                    }
                }
                else {
                 
                    setTimeout(function() { multiAlinear(); }, 500);   
                }
            });
            
            
            $('#helpTcCode').click(function() {
                if ($('#imgVerificacion').css("display")=='none'){
                    $('#imgVerificacion').css("display","block");
                }
                else {
                    $('#imgVerificacion').css("display","none");
                }
            });
            
            
            $('.btn-group-radio').click(function(e) {
                e.preventDefault();
            });
            
            $('#tipoPago').change(function() {
                if (!numOK){
                    return false;
                }

                if ($('#tipoPago').val()=='VN'){
                    $( "#numCuotas" ).html("");
                    $( "#numCuotas" ).append( '<option value="0" selected>0</option>' );
                    return false;
                }
                
                $( "#loadingNroCuotas" ).css("display","inline");
                setTimeout(function() { multiAlinear(); }, 500);
                $.ajax({
                      url: "/checkout.checkoutcontroller/getNroCuotas?nroTarjeta="+$("#numeroTarjeta").val()+"&cSInteres="+$('#tipoPago').val()+"&slugAgency="+AGENCY_SLUGIFIED_PATH
                    }).done(function(d) {
                        fillNroCuotas(d);
                        $( "#loadingNroCuotas" ).css("display","none");
                        setTimeout(function() { multiAlinear(); }, 500);
                    });
             });
             
            $('.tccardopt').click(function() {
                 var cName = $(this).attr('class');
                 var choosenOpt = cName.substring(0,cName.indexOf(' '));
                 if (choosenOpt == 'card1'){
                     $('#radio1').prop('checked',true);
                 }
                 else if (choosenOpt == 'card2'){
                     $('#radio2').prop('checked',true);
                 }
                 else {
                     $('#radio3').prop('checked',true);
                 }
            });
             
            $( "#numeroCuotas" ).change(function() {
                var t = $( "#numeroCuotas option:selected" ).text();
                if (t=='Sin Cuotas'){
                    $('#numCuotas').val(0);
                    $('#tipoPago').val( 'VN');
                }
                else {
                    $('#numCuotas').val( t.substring(0,t.indexOf(' ')));
                    $('#tipoPago').val( $( "#numeroCuotas" ).val());
                }
                
				var bin = $("#numeroTarjeta").val().substring(0,6);
				$.ajax({
					url: "/checkout.checkoutcontroller/numeroCuotasSelected?cuotas="+t+"&bin="+bin+"&slugAgency="+AGENCY_SLUGIFIED_PATH+"&buyingId="+ORDER_BUYING_ID
				});
                
            });
            
            setTimeout(function() { multiAlinear(); }, 500);
                        
                                                    setTimeout(function() { multiAlinear(); }, 500);
                                    
                
                                    if ($('#maxAvailableDP').html()!=null) {

                                                $('#dolaresPremio').val(MAXIMO_DP);
                                                
                        calculateDP();

                        $('#maxAvailableDP').html(numberWithCommas($('#dolaresPremio').val().replace(/\./g, ',')));
                        
                                                    
                        if($('.spnDPTarifa').html() != undefined){
                            $(".spnDPTarifa").html(numberWithCommas($('.spnDPTarifa').html().replace(/\./g, ',')));
                        }

                        if($('.spnDPTarifa').html() != undefined){
                            $(".spnTotal").html(numberWithCommas($('.spnTotal').html().replace(/\./g, ',')));
                        }

                                            
                    }
                                                
                
        });
        
        function getCardPics(){
            $( "#loadingTCPic" ).css("display","inline");
            setTimeout(function() { multiAlinear(); }, 500);

            var bin = $("#numeroTarjeta").val().substring(0,6);

            $.ajax({
                url: "/checkout.checkoutcontroller/getCardPic?bin="+bin+"&promo="+PROMOTION_CODE+"&agencySlug="+AGENCY_SLUGIFIED_PATH
            }).done(function(d) {
                $( "#loadingTCPic" ).css("display","none");
                if (d!='NOBIN'){
                    $('#spTCPicPlacer').html('<img id="theImg" src="' + d.miniCard +'" />');
                    //Inicio parche imagen logo
                    var logoCrossElement = document.getElementById("logoCrossElement");
                    if (logoCrossElement != null)
                    {
                        d.banner = logoCrossElement.getAttribute("imgOrigin");
                    }
                    //Fin parche imagenlogo
                    $('#bannerPlace').html('<img src="' + d.banner+'">');                    
                }
                setTimeout(function() { multiAlinear(); }, 250);
            });
        }
        
        function getSpecialPromos(){
            $( "#SpecialPromoMsg" ).css("display","block");
            setTimeout(function() { multiAlinear(); }, 500);
            var bin = $("#numeroTarjeta").val().substring(0,6);
            $.ajax({
                  url: "/checkout.checkoutcontroller/getSpecialPromos?bin="+bin+"&promo="+PROMOTION_CODE
                }).done(function(d) {

                    if (d.status=='NOK'){
                        $('#hasPromo').val("false");
                        $('#isDp').val("false");
                        $('#SpecialPromoMsg').css("color","red");
                        $('#SpecialPromoMsg').html('Para esta tarjeta no aplica descuento promocional');
                        $("#totalPesos").css("display", "none");

                        calculateDP();

                        if (isNaN(parseFloat($('#dpTotal').html())) || parseFloat($('#dpTotal').html()) <= 0.0) {
                            $("li.total span.value").html("$" + $("#totalNoDescuento").val());
                            $("li.tcBco span.value").html("$<span id=\"montoAPagar\">" + $("#totalNoDescuento").val() + "</span>");
                            $("#montoAPagar2").html($("#totalNoDescuento").val());
                        }
                    } else if (d.status=='OK'){
                        $('#hasPromo').val("true");

                        
                        $('#SpecialPromoMsg').css("color","green");
                        $('.resumenPromo').css("color","green");
                        $('#SpecialPromoMsg').html('Tarjeta con Beneficios Exclusivos');
                        $("#totalPesos").css("display", "block");

                        calculateDP();

                        if (isNaN(parseFloat($('#dpTotal').html())) || parseFloat($('#dpTotal').html()) <= 0.0) {
                            $("li.total span.value").html("$" + $("#totalDescuento").val());
                            $("li.tcBco span.value").html("$<span id=\"montoAPagar\">" + $("#totalDescuento").val() + "</span>");
                            $("#montoAPagar2").html($("#totalDescuento").val());
                        }
                    } else {
                        $( "#SpecialPromoMsg" ).css("display","none");
                    }
                    setTimeout(function() { multiAlinear(); }, 250);

                }).fail( function() {
                    $( "#SpecialPromoMsg" ).css("display","none");
                    setTimeout(function() { multiAlinear(); }, 250);
                });
        }
        
        
        function fillNroCuotas(fdp){
            var formasDePago = fdp;

            var arr = formasDePago.split(",");
            var installmentsRestriction = getInstallmentsRestriction();
        
            $( "#TCErrorBin" ).css("display","none");
            if (formasDePago=='NOBIN'){
                invalidarTC("TCErrorBin");
                return false;
            }

            $( "#numCuotas" ).html("");

            for (var i = 0; i < arr.length-1; i++) {
                if ( installmentsRestriction.length == 0 || (installmentsRestriction.length > 0 &&  installmentsRestriction.indexOf(arr[i].valorCuota.toString()) >= 0 ) ){
                    $( "#numCuotas" ).append( '<option value=\"'+ arr[i] +'\">' + arr[i] + '</option>' );
                }
            }
        }

        function restoreDefaultPromosValues(){
                                        $( "#isDp" ).val("false");
            
                                        $( "#hasPromo" ).val("false");
                    }


        function fillNroCuotas3(fdp){
            var formasDePago = fdp;
            var installmentsRestriction = getInstallmentsRestriction();

            $( "#TCErrorBin" ).css("display","none");
            if (formasDePago==''){
                invalidarTC("TCErrorBin");
                return false;
            }

            $( "#numeroCuotas" ).html("");
            
            $( "#numeroCuotas" ).append( '<option value="0">Sin Cuotas</option>' );
            var stringSI = '';
            var stringCI = '';

            for (i = 0; i < formasDePago.length; i++) {
                if (installmentsRestriction.length == 0 || (installmentsRestriction.length > 0 && installmentsRestriction.indexOf(formasDePago[i].valorCuota.toString()) >= 0 )){
                    if (formasDePago[i].tipoPago=='SI'){
                        stringSI = stringSI + '<option value=\"'+ formasDePago[i].tipoPagoInformado +'\" selected>' + formasDePago[i].valorCuota + ' cuotas sin interes</option>';
                        $('#tipoPago').val( formasDePago[i].tipoPagoInformado);
                        $('#numCuotas').val( formasDePago[i].valorCuota);
                    } else {
                        if ( formasDePago[i].valorCuota!='0' ) {
                            stringCI = stringCI + '<option value=\"'+ formasDePago[i].tipoPagoInformado +'\" >' + formasDePago[i].valorCuota + ' cuotas</option>' ;
                        }
                    }
                }
            }
            $( "#numeroCuotas" ).append(stringSI+stringCI);
            
            
			var t = $( "#numeroCuotas option:selected" ).last().text();
            var bin = $("#numeroTarjeta").val().substring(0,6);
			$.ajax({
				url: "/checkout.checkoutcontroller/numeroCuotasSelected?cuotas="+t+"&bin="+bin+"&slugAgency="+AGENCY_SLUGIFIED_PATH+"&buyingId="+ORDER_BUYING_ID
			});
        }

        function getInstallmentsRestriction(){
            var installmentsRestriction = [];

            if (INSTALLMENTS_RESTRICTION != ""){
                installmentsRestriction = INSTALLMENTS_RESTRICTION.split(',');
            }

            return installmentsRestriction;
        }
        
        
            function calculateDP(){

                var dolaresPremioCalculados;

                dolaresPremioCalculados = Math.min(new Number($('#dolaresPremio').val()),new Number(MAXIMO_DP),new Number(MAX_DP_AMOUNT_RESTRICTION));

                if (isNaN(dolaresPremioCalculados)){
                    dolaresPremioCalculados = 0;
                }

                $('#dolaresPremio').val(dolaresPremioCalculados.toFixed(2));
                $("#realDP").val(dolaresPremioCalculados);

                var realDPPremio = dolaresPremioCalculados;

                $("#realDP").val(realDPPremio);

                var totalNegocio = getTotalNegocio();

                var clpPremioCalculado = getClp(dolaresPremioCalculados.toString());
                var clpPremioAMostrar = parseInt(clpPremioCalculado).toFixed(2);

                if (pagoTodoConDPs()){

                    restoreDefaultPromosValues();

                    if(isDpPromo()){
                        totalNegocio = $('#totalDescuento').val().replace(/\./g, '');
                    } else {
                        totalNegocio = getTotalNegocio();
                    }

                    var dpsDePromo = getDolaresPremio(totalNegocio);
                    dolaresPremioCalculados = Math.min(new Number(dpsDePromo), new Number(MAX_DP_AMOUNT_RESTRICTION));

                    $("#realDP").val(dolaresPremioCalculados);
                    $('#dolaresPremio').val(dolaresPremioCalculados.toFixed(2));

                    clpPremioCalculado = getClp(dolaresPremioCalculados);

                    $("#convertedDP").html(addCommas(parseInt(Math.ceil(clpPremioCalculado*100)/100)));

                } else {

                    if(clpPremioAMostrar.indexOf(".00") != -1){
                        clpPremioAMostrar = clpPremioAMostrar.replace('.00', '');
                    }

                    $("#convertedDP").html(addCommas(parseInt(clpPremioAMostrar)));
                }

                var total = parseFloat(Decimal(totalNegocio).minus(Decimal(clpPremioCalculado)).toString());

                if (isNaN(total)){
                    total = parseFloat(totalNegocio);
                }

                if (total < parseFloat(AGENCY_ROUNDING_AMOUNT) && total > 0){
                    $('#cartelMinRoundingAmount').css("display","block");
                    $('#dolaresPremio').focus();
                    disableTCStep();
                } else {
                    $('#cartelMinRoundingAmount').css("display","none");
                    enableTCStep();
                }

                $('#montoAPagar').html(total.toFixed(2));
                $('#montoAPagar2').html(total.toFixed(2));
                $('#dpTotal').html(addCommas(parseInt(Math.ceil(clpPremioCalculado*100)/100)));

                var monto = $('#montoAPagar').html();

                if (monto.indexOf('.')!=-1) {
                    monto = monto.substring(0,monto.length-3);
                    $('#montoAPagar').html(addCommas(monto));
                    $('#montoAPagar2').html(addCommas(monto));
                    $('#resMontoTarj').html(addCommas(monto));
                }

                if ($('#dolaresPremio').val()==null || $('#dolaresPremio').val()==''){
                    $('#resDP').html("0");
                } else {
                    $('#resDP').html($('#dolaresPremio').val());
                }

                montoAPagar(total);

                if ($('#montoAPagar').html()=='0'){
                    disableTCStep();
                }


                if ( isNaN(parseFloat($('#convertedDP').html())) ){
                    $('#convertedDP').html("0");
                }

                if ( isNaN(parseFloat($('#dpTotal').html())) ){
                    $('#dpTotal').html("0");
                }

                if (clpPremioCalculado<totalNegocio){
                    multiAlinear();
                }

                if ($('#montoAPagar2').html()=="0"){
                    disableTCStep();
                }

                if(hasPromo()){
                    if(isDpPromo() && $("#montoAPagar").html() != "0"){
                        $("#totalPesos").css("display", "none");
                        $("li.total span.value").html("$"+$("#totalNoDescuento").val());
                    }else{
                        $('.resumenPromo').css("color","green");
                        $("#totalPesos").css("display", "block");
                        $("li.total span.value").html("$"+$("#totalDescuento").val());
                    }
                }else{
                    $("li.total span.value").html("$"+$("#totalNoDescuento").val());
                }


                /************ INNER FUCTIONS *********************/
                function getTotalNegocio(){

                    var totalNegocio;

                    if(!hasPromo() || (hasPromo() && isDpPromo())){
                        totalNegocio = $('#totalNoDescuento').val().replace(/\./g, '');
                    }else{
                        totalNegocio = $('#totalDescuento').val().replace(/\./g, '');
                    }

                    return totalNegocio;
                }

                function isDpPromo() {
                    return $("#isDp").val() == "true";
                }

                function hasPromo() {
                    return $("#hasPromo").val() == "true";
                }

                function pagoTodoConDPs() {
                    return Decimal(clpPremioCalculado).cmp(Decimal(totalNegocio)) >= 0;
                }
            }

            function getDolaresPremio(clpAmount) {
                Decimal.set({ rounding: Decimal.ROUND_HALF_EVEN });
                Decimal.set({ precision: 10 });

                var clps = new Decimal(clpAmount);
                var exch = new Decimal(AGENCY_DOLLAR_EXCHANGE_RATE);

                var result = clps.div(exch).toString();

                return result;
            }

            function getClp(dpAmount) {

                Decimal.set({ rounding: Decimal.ROUND_HALF_EVEN });
                Decimal.set({ precision: 10 });

                var dp = new Decimal(dpAmount);
                var tdc = new Decimal(AGENCY_DOLLAR_EXCHANGE_RATE);

                var result = dp.times(tdc).round().toString();

                return result;
            }
                            
            
        function addCommas(n){
            var rx=  /(\d+)(\d{3})/;
            return String(n).replace(/^\d+/, function(w){
                while(rx.test(w)){
                    w= w.replace(rx, '$1.$2');
                }
                return w;
            });
        }
        
        function numberWithCommas(x) {
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }
        
        function disableTCStep(){
            $('input,select','#stepTC').prop("disabled", 'disabled');
            $('#stepTC').css('background-color','#F1F1F1');
            $( "#bannerPlace" ).html("");
            $( "#spTCPicPlacer" ).html("");
            $('#numeroTarjeta').val('');
            $("#numeroTarjeta").css("border-color",'');

            numOK=false;

            $( "#SpecialPromoMsg" ).css("display","none");
            restoreDefaultPromosValues();
        }
        
        function enableTCStep(){
            $('input,select','#stepTC').prop("disabled", '');
            $('#stepTC').css('background-color','');
        }
        
        function sendPayment(typeOfPayment){
            
            var fechaVto = $('#select2').val() + "/" + $('#select1').val();
            $('#fechaVctoTarjeta').val(fechaVto);

                            var dpAmount = $('#realDP').length == 0 ? '0' : $('#realDP').val();
                        
            var tcAmount = "";

            if ($('#numeroTarjeta').val()!=undefined){
                tcAmount = $('#montoAPagar').html().replace(/\./g, '');
            }
            
            var email = $("#email").val() != undefined ? $("#email").val() : "";
            var chkOfertas = $("#chkOfertas").val();
            var tipoPago='';
            
            if ( $('#numCuotas').val()=='0' ){
                 tipoPago='VN';
            } else {
                tipoPago = $('#tipoPago').val();
            }

            var promoDiscount ='0';

            if ($("#totalPesos").is(":visible") ){
                promoDiscount = $("#discount").html().replace(/\./g, '');
            }

			var solicitudDP = $("#solicitudDP").prop('checked');

            var formData = {
                bId: ORDER_BUYING_ID,
                dpAmount: dpAmount,
                tcAmount: tcAmount,
                promoDiscount: promoDiscount,
                orderEmail: email,
                solicitudDP: solicitudDP,
                tipoPago: tipoPago,
                chkOfertas:chkOfertas
                            };

            var form =  $('#frmOrderPay');
            
            $.ajax({
                type: $(form).prop("method"),
                url: $(form).prop("action"),
                data: formData,
                success: function (data) {
                    if (data == 'EXPIRED' ) {
                        $('#myModal').modal({show:true});
                        $("#btnPagar").removeAttr("disabled");
                        return false;
                    }
                    else if (data=='ORDENALREADYPAID'){
                        $('#modalAlreadyPaid').modal({show:true});
                        $("#btnPagar").removeAttr("disabled");
                        return false;
                    }
                    else if (data=='NOAVAILABLEDP'){
                        $('#modalNoDP').modal({show:true});
                        $("#btnPagar").removeAttr("disabled");
                        return false;
                    }
                    else if (data=='AMOUNTERROR'){
                        $('#modalAmountError').modal({show:true});
                        $("#btnPagar").removeAttr("disabled");
                        return false;
                    }
                    else if (data=='TOTALERROR'){
                        $('#modalTotalError').modal({show:true});
                        $("#btnPagar").removeAttr("disabled");
                        return false;
                    }
                    
                    var montoDPToSend = $('#dolaresPremio').val();
                    
                    if (montoDPToSend==null || montoDPToSend=='' || isNaN(montoDPToSend)){
                        montoDPToSend = 0;
                    }
                    var bId = btoa(ORDER_BUYING_ID);
                    var rut = btoa(ORDER_RUT);
                    var dpAmount = btoa(montoDPToSend);

                    if (typeOfPayment == 'SINTC'){
                         var dataString = "type=dp&buyingId="+bId+"&rut="+rut+"&montoDP="+dpAmount;
                        $.ajax({
                            url: "/startPayment",
                            method: "POST",
                            data: dataString
                        }).done(function(d) {
                            window.location.href = d;
                        });
                    }
                    else {
                        var montoTC = $('#montoAPagar').html().replace(/\./g, '');
                        if ($('#numCuotas').val()==null || $('#numCuotas').val()=='') {
                            $('#numCuotas').append('<option value="0" selected></option>');
                        }
                        
                        var bId = btoa(ORDER_BUYING_ID);
                        var rut = btoa(ORDER_RUT);
                        var monto = btoa(montoTC);
                        var descuento = btoa(promoDiscount)
                        var tchsh = btoa($('#numeroTarjeta').val());
                        var vtohsh = btoa($('#fechaVctoTarjeta').val());
                        var vercodehsh = btoa($('#codigoVerificacion').val());
                        var sharehsh = btoa($('#numCuotas').val());
                        var montodphsh = btoa(montoDPToSend);
                        var binhsh = btoa($("#numeroTarjeta").val().substring(0,6));

                        var dataString = "type=tc&buyingId="+bId+"&amount="+monto+"&discount="+descuento+"&rut="+rut+"&tcNumber="+tchsh+"&vto="+ vtohsh +"&verCode="+ vercodehsh +"&shares="+sharehsh+"&montoDP="+montodphsh+"&bin="+binhsh;
                        
                        //Le voy a pegar a mi metodo para que le pegue a spring
                        $.ajax({
                            url: "/startPayment",
                            method: "POST",
                            data: dataString
                        }).done(function(d) {
                            window.location.href = d;
                        });
                    }
                },
                error: function (data) {
                    $("#btnPagar").removeAttr("disabled");
                }
            });
        }

        $("#dolaresPremioSelect").on('change', function() {
            var value = $(this).val();

            
            $("#dolaresPremio").val(value);

            calculateDP();
        });
        
        function multiAlinear(){ 
            try {
                $("#line1").css("left", $("#circleBase1").offset().left + 19);
                $("#line1").css("top", $("#circleBase1").offset().top + 40);
                $("#line1").css("height", $("#circleBase2").offset().top - $("#circleBase1").offset().top - 40);
            }catch(err) {
                $("#line1").hide();
            }
            
            try {
                $("#line2").css("left", $("#circleBase2").offset().left + 19);
                $("#line2").css("top", $("#circleBase2").offset().top + 40);
                $("#line2").css("height", $("#circleBase3").offset().top - $("#circleBase2").offset().top - 40);
            }catch(err) {
                $("#line2").hide();
            }
            
            try {
                $("#line3").css("left", $("#circleBase3").offset().left + 19);
                $("#line3").css("top", $("#circleBase3").offset().top + 40);
                $("#line3").css("height", $("#circleBase4").offset().top - $("#circleBase3").offset().top - 40);
            }catch(err) {
                $("#line3").hide();
            }
                        
        }
        
        $( window ).resize(function() {
            multiAlinear();        
        });

            </script>
	</body>
</html>